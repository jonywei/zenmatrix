<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è´¦æˆ·</title>
    <link rel="stylesheet" href="https://cdn.staticfile.net/element-plus/2.3.8/index.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.staticfile.net/vue/3.3.4/vue.global.min.js"></script>
    <script src="https://cdn.staticfile.net/element-plus/2.3.8/index.full.min.js"></script>
    <script src="https://cdn.staticfile.net/axios/1.6.0/axios.min.js"></script>
    <style>[v-cloak]{display:none}</style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen flex flex-col">
        
        <div class="bg-white p-6 pb-10 rounded-b-3xl shadow-sm relative z-10">
            <div class="flex justify-between items-center mb-6">
                <a href="/" class="text-gray-500 text-lg">â† å·¥ä½œå°</a>
                {% if user.is_staff %}
                <a href="/admin/" class="text-xs bg-gray-800 text-white px-3 py-1 rounded-full">è¿›å…¥åå° ></a>
                {% endif %}
            </div>
            
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold shadow-lg shadow-blue-200">
                    {{ user.initials|default:user.username|slice:":1"|upper }}
                </div>
                <div>
                    <div class="text-xl font-bold text-gray-800">{{ user.username }}</div>
                    <div class="text-sm text-gray-500 mt-1">
                        è§’è‰²: <span class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded text-xs">{{ user.role }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-4 -mt-4 relative z-20 space-y-3">
            <div class="bg-white rounded-xl p-4 shadow-sm flex justify-between items-center cursor-pointer active:bg-gray-50">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-yellow-50 text-yellow-600 flex items-center justify-center">ğŸ“Š</div>
                    <span class="text-sm font-bold text-gray-700">æœ¬æœˆä¸šç»©</span>
                </div>
                <span class="text-gray-400 text-xs">æš‚æ— ç»Ÿè®¡ ></span>
            </div>

            <div class="bg-white rounded-xl p-4 shadow-sm flex justify-between items-center cursor-pointer active:bg-gray-50" @click="changePwd">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-green-50 text-green-600 flex items-center justify-center">ğŸ”’</div>
                    <span class="text-sm font-bold text-gray-700">ä¿®æ”¹å¯†ç </span>
                </div>
                <span class="text-gray-400 text-xs">></span>
            </div>
        </div>

        <div class="p-4 mt-auto">
            <button @click="logout" class="w-full bg-white border border-red-200 text-red-500 py-3 rounded-xl font-bold hover:bg-red-50 transition">
                é€€å‡ºç™»å½•
            </button>
        </div>

    </div>

    <script>
        const { createApp } = Vue
        const { ElMessage, ElMessageBox } = ElementPlus
        axios.defaults.headers.common['X-CSRFToken'] = '{{ csrf_token }}';

        createApp({
            methods: {
                async logout() {
                    if(confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ')) {
                        await axios.get('/api/logout/');
                        window.location.href = '/login/';
                    }
                },
                async changePwd() {
                    const pwd = prompt("è¯·è¾“å…¥æ–°å¯†ç ");
                    if(pwd) {
                        try {
                            await axios.post('/api/change_password/', {password: pwd});
                            alert('ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•');
                            window.location.href = '/login/';
                        } catch(e) { alert('ä¿®æ”¹å¤±è´¥'); }
                    }
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>